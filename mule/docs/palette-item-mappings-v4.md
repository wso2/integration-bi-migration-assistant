###### This markdown file is AUTO-GENERATED by the test suite. Do not modify manually. ######

# Supported Mule 4.x Components

- [Async](palette-item-mappings-v4.md#async)
- [Choice](palette-item-mappings-v4.md#choice)
- [Config Property Access](palette-item-mappings-v4.md#config-property-access)
- [Database Connector](palette-item-mappings-v4.md#database-connector)
- [Error Handler](palette-item-mappings-v4.md#error-handler)
- [Expression Component](palette-item-mappings-v4.md#expression-component)
- [First Successful](palette-item-mappings-v4.md#first-successful)
- [Flow](palette-item-mappings-v4.md#flow)
- [For Each](palette-item-mappings-v4.md#for-each)
- [Http Listener](palette-item-mappings-v4.md#http-listener)
- [Http Request](palette-item-mappings-v4.md#http-request)
- [Logger](palette-item-mappings-v4.md#logger)
- [Message Enricher](palette-item-mappings-v4.md#message-enricher)
- [Object To Json](palette-item-mappings-v4.md#object-to-json)
- [Object To String](palette-item-mappings-v4.md#object-to-string)
- [On Error Continue](palette-item-mappings-v4.md#on-error-continue)
- [On Error Propagate](palette-item-mappings-v4.md#on-error-propagate)
- [Raise Error](palette-item-mappings-v4.md#raise-error)
- [Scatter Gather](palette-item-mappings-v4.md#scatter-gather)
- [Scheduler](palette-item-mappings-v4.md#scheduler)
- [Set Payload](palette-item-mappings-v4.md#set-payload)
- [Sub Flow](palette-item-mappings-v4.md#sub-flow)
- [Transform Message](palette-item-mappings-v4.md#transform-message)
- [Try](palette-item-mappings-v4.md#try)
- [Variable](palette-item-mappings-v4.md#variable)
- [Vm Connector](palette-item-mappings-v4.md#vm-connector)
# Sample Input and Output (Mule 4.x)

The `mule-to-ballerina-migration-assistant` project includes sample input and output files for Mule 4.x to demonstrate the conversion process. These samples are located in the `src/test/resources/mule/v4/blocks` directory.

## Async

- ### Simple Async

**Input (simple_async.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:request-config name="http_request_config" doc:name="HTTP Request configuration" doc:id="1e0d78e1-e5fb-44a9-9b18-b86c0d151be6" >
        <http:request-connection host="jsonplaceholder.typicode.com" port="80" protocol="HTTPS"/>
    </http:request-config>
    <flow name="demoFlow" doc:id="1d088811-dee1-455d-a909-529d3c54662f" >
        <set-payload value="#['John']" doc:name="Set Payload" doc:id="39f96c58-748d-48b4-a0e7-ad09c6ea78af" />
        <async doc:name="Async" doc:id="077acc98-7b87-4ded-86b4-e3c6d09ed191" >
            <set-payload value="#['Harry']" doc:name="Set Payload" doc:id="08788a6b-3204-4082-bb0e-6817b210dfd3" />
            <logger level="INFO" doc:name="Logger" doc:id="5712b8c7-c7a1-42dd-84d8-b2bc561e7030" message="Payload updated to: #[payload]"/>
        </async>
        <logger level="INFO" doc:name="Logger" doc:id="d0390e1c-7a02-44af-87b0-41f9834a6158" message="Payload is '#[payload]'"/>
    </flow>
</mule>

```
**Output (simple_async.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

public function demoFlow(Context ctx) {

    // set payload
    string payload0 = "John";
    ctx.payload = payload0;

    // async operation
    _ = start async0(ctx);
    log:printInfo(string `Payload is '${ctx.payload.toString()}'`);
}

public function async0(Context ctx) {

    // set payload
    string payload1 = "Harry";
    ctx.payload = payload1;
    log:printInfo(string `Payload updated to: ${ctx.payload.toString()}`);
}

```

## Choice

- ### Basic Choice

**Input (basic_choice.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:vm="http://www.mulesoft.org/schema/mule/vm" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd">
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <set-variable value="#[29]" doc:name="Set Variable" doc:id="c92878cc-4b5f-4965-858d-55c6ab90e62b" variableName="age" />
        <choice doc:name="Choice" doc:id="b9372ec9-6743-4047-945e-b378284f018f" >
            <when expression="#[vars.age &gt; 18]">
                <logger level="INFO" doc:name="Logger" doc:id="120cc6e6-95af-4b47-9e42-68cb91f33b6a" message="Adult detected: Age is #[vars.age] years."/>
            </when>
            <otherwise >
                <logger level="INFO" doc:name="Logger" doc:id="5e5c770a-1d59-4d36-8142-51f10fdecf34" message="Minor detected: Age is #[vars.age] years."/>
            </otherwise>
        </choice>
    </flow>
</mule>

```
**Output (basic_choice.bal):**
```ballerina
import ballerina/log;

public type Vars record {|
    int age?;
|};

public type Context record {|
    anydata payload = ();
    Vars vars = {};
|};

public function demoFlow(Context ctx) {
    ctx.vars.age = 29;
    if ctx.vars.age > 18 {
        log:printInfo(string `Adult detected: Age is ${ctx.vars.age.toString()} years.`);
    } else {
        log:printInfo(string `Minor detected: Age is ${ctx.vars.age.toString()} years.`);
    }
}

```

- ### Choice With Http Listener Source

**Input (choice_with_http_listener_source.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:vm="http://www.mulesoft.org/schema/mule/vm" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/choice" allowedMethods="GET"/>
        <set-variable value="#[73]" doc:name="Set Variable" doc:id="c92878cc-4b5f-4965-858d-55c6ab90e62b" variableName="marks" />
        <choice doc:name="Choice" doc:id="b9372ec9-6743-4047-945e-b378284f018f" >
            <when expression="#[vars.marks &gt;= 75]">
                <logger level="INFO" doc:name="Logger" doc:id="120cc6e6-95af-4b47-9e42-68cb91f33b6a" message="You have scored #[vars.marks]. Your grade is 'A'."/>
            </when>
            <when expression="#[vars.marks &gt;= 65]">
                <logger level="INFO" doc:name="Logger" doc:id="3994d7b7-a1e1-455a-a640-c59c6f93b6e5" message="You have scored #[vars.marks]. Your grade is 'B'."/>
            </when>
            <when expression="#[vars.marks &gt;= 55]">
                <logger level="INFO" doc:name="Logger" doc:id="097f3b96-f6c8-4105-ab0b-62a8bdeac92f" message="You have scored #[vars.marks]. Your grade is 'C'."/>
            </when>
            <otherwise >
                <logger level="INFO" doc:name="Logger" doc:id="5e5c770a-1d59-4d36-8142-51f10fdecf34" message="You have scored #[vars.marks]. Your grade is 'F'."/>
            </otherwise>
        </choice>
    </flow>
</mule>

```
**Output (choice_with_http_listener_source.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Vars record {|
    int marks?;
|};

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Vars vars = {};
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get choice(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        ctx.vars.marks = 73;
        if ctx.vars.marks >= 75 {
            log:printInfo(string `You have scored ${ctx.vars.marks.toString()}. Your grade is 'A'.`);
        } else if ctx.vars.marks >= 65 {
            log:printInfo(string `You have scored ${ctx.vars.marks.toString()}. Your grade is 'B'.`);
        } else if ctx.vars.marks >= 55 {
            log:printInfo(string `You have scored ${ctx.vars.marks.toString()}. Your grade is 'C'.`);
        } else {
            log:printInfo(string `You have scored ${ctx.vars.marks.toString()}. Your grade is 'F'.`);
        }

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Choice With Multiple Conditions

**Input (choice_with_multiple_conditions.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:vm="http://www.mulesoft.org/schema/mule/vm" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd">
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <set-variable value="#[73]" doc:name="Set Variable" doc:id="c92878cc-4b5f-4965-858d-55c6ab90e62b" variableName="marks" />
        <choice doc:name="Choice" doc:id="b9372ec9-6743-4047-945e-b378284f018f" >
            <when expression="#[vars.marks &gt;= 75]">
                <logger level="INFO" doc:name="Logger" doc:id="120cc6e6-95af-4b47-9e42-68cb91f33b6a" message="You have scored #[vars.marks]. Your grade is 'A'."/>
            </when>
            <when expression="#[vars.marks &gt;= 65]">
                <logger level="INFO" doc:name="Logger" doc:id="3994d7b7-a1e1-455a-a640-c59c6f93b6e5" message="You have scored #[vars.marks]. Your grade is 'B'."/>
            </when>
            <when expression="#[vars.marks &gt;= 55]">
                <logger level="INFO" doc:name="Logger" doc:id="097f3b96-f6c8-4105-ab0b-62a8bdeac92f" message="You have scored #[vars.marks]. Your grade is 'C'."/>
            </when>
            <otherwise >
                <logger level="INFO" doc:name="Logger" doc:id="5e5c770a-1d59-4d36-8142-51f10fdecf34" message="You have scored #[vars.marks]. Your grade is 'F'."/>
            </otherwise>
        </choice>
    </flow>
</mule>

```
**Output (choice_with_multiple_conditions.bal):**
```ballerina
import ballerina/log;

public type Vars record {|
    int marks?;
|};

public type Context record {|
    anydata payload = ();
    Vars vars = {};
|};

public function demoFlow(Context ctx) {
    ctx.vars.marks = 73;
    if ctx.vars.marks >= 75 {
        log:printInfo(string `You have scored ${ctx.vars.marks.toString()}. Your grade is 'A'.`);
    } else if ctx.vars.marks >= 65 {
        log:printInfo(string `You have scored ${ctx.vars.marks.toString()}. Your grade is 'B'.`);
    } else if ctx.vars.marks >= 55 {
        log:printInfo(string `You have scored ${ctx.vars.marks.toString()}. Your grade is 'C'.`);
    } else {
        log:printInfo(string `You have scored ${ctx.vars.marks.toString()}. Your grade is 'F'.`);
    }
}

```

## Config Property Access

- ### Config Property Access In Message

**Input (config_property_access_in_message.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="listener_config" doc:name="HTTP Listener config" doc:id="73a0fa89-f2fe-48ca-a692-eb28f9809a9c" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="${http.port}" />
    </http:listener-config>
    <db:config name="db_config" doc:name="Database Config" doc:id="e8bc20de-c3ee-450e-a42a-4c8940636ea6" >
        <db:my-sql-connection host="${db.host}" port="${db.port}" user="${db.user}" password="${db.password}" database="${db.database}" />
    </db:config>
    <configuration-properties doc:name="Configuration properties" doc:id="c366b738-c9b9-4915-9094-4c5e363c630f" file="config.yaml" />
    <flow name="demoFlow" doc:id="4a79ef8b-6421-4704-9d8f-2c6c3817a45d" >
        <http:listener doc:name="Listener" doc:id="6c4ca706-9983-47cd-9282-479ce0780c78" config-ref="listener_config" allowedMethods="GET" path="property_access"/>
        <set-variable value="#[p('http.host') ++ ':' ++ p('http.port')]" doc:name="Set DB Connection String" doc:id="1d96e838-5365-4994-8283-5b1d1dbbfdf5" variableName="dbConnectionString"/>
        <logger level="INFO" doc:name="Log App Running Port" doc:id="91bd5a2d-3cec-431f-89f4-9fea74eb5fe3" message="#['App running on port: ' ++ p('http.port')]"/>
        <db:select doc:name="Select" doc:id="10c7026c-bfd7-4d41-8f95-c7a0df37c74f" config-ref="db_config">
            <db:sql ><![CDATA[SELECT * FROM USERS;]]></db:sql>
        </db:select>
        <logger level="INFO" doc:name="Logger" doc:id="b33e3b7f-2ea2-4d11-8a95-2d9daa4fe4fc" message="#['Welcome, ' ++ p('user.firstName') ++ ' ' ++ p('user.lastName') ++ '. Your account balance is ' ++ p('user.balance')]"/>
    </flow>
</mule>

```
**Output (config_property_access_in_message.bal):**
```ballerina
import ballerina/http;
import ballerina/log;
import ballerina/sql;
import ballerinax/mysql;
import ballerinax/mysql.driver as _;

public type Vars record {|
    anydata dbConnectionString?;
|};

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Vars vars = {};
    Attributes attributes;
|};

public type Record record {
};

configurable string http_host = ?;
configurable string http_port = ?;
configurable string user_firstName = ?;
configurable string user_lastName = ?;
configurable string user_balance = ?;
configurable string db_host = ?;
configurable string db_user = ?;
configurable string db_password = ?;
configurable string db_database = ?;
configurable string db_port = ?;
mysql:Client db_config = check new (db_host, db_user, db_password, db_database, check int:fromString(db_port));
public listener http:Listener listener_config = new (check int:fromString(http_port));

service /mule4 on listener_config {
    resource function get property_access(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        ctx.vars.dbConnectionString = http_host + ":" + http_port;
        log:printInfo("App running on port: " + http_port);

        // database operation
        sql:ParameterizedQuery dbQuery0 = `SELECT * FROM USERS;`;
        stream<Record, sql:Error?> dbStream0 = db_config->query(dbQuery0);
        Record[] dbSelect0 = check from Record _iterator_ in dbStream0
            select _iterator_;
        ctx.payload = dbSelect0;
        log:printInfo("Welcome, " + user_firstName + " " + user_lastName + ". Your account balance is " + user_balance);

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Global Property

**Input (global_property.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <global-property doc:name="Global Property" doc:id="80008100-f2ec-4e8c-9e9f-21c0615df09c" name="company.name" value="WSO2" />
    <flow name="demoFlow" doc:id="150c5b03-c0a2-437c-af88-f5a80a77eb51" >
        <logger level="INFO" doc:name="Logger" doc:id="03486a7b-2cd8-4d55-a1a5-f583c7eec67c" message="Company name : ${company.name}"/>
    </flow>
</mule>

```
**Output (global_property.bal):**
```ballerina
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

configurable string company_name = "WSO2";

public function demoFlow(Context ctx) {
    log:printInfo(string `Company name : ${company_name}`);
}

```

## Database Connector

- ### Basic Db Select

**Input (basic_db_select.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <db:config name="mySql_Config" doc:name="Database Config" doc:id="26c3cfa7-455f-4760-9df6-8f2a490040a3" >
        <db:my-sql-connection host="localhost" port="3306" user="root" password="admin123" database="test_db" />
    </db:config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/db" allowedMethods="GET"/>
        <db:select doc:name="Select" doc:id="b946197c-a423-45ab-b8e4-0abb79a0e2b1" config-ref="mySql_Config">
            <db:sql ><![CDATA[SELECT * FROM users;]]></db:sql>
        </db:select>
    </flow>
</mule>

```
**Output (basic_db_select.bal):**
```ballerina
import ballerina/http;
import ballerina/sql;
import ballerinax/mysql;
import ballerinax/mysql.driver as _;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public type Record record {
};

mysql:Client mySql_Config = check new ("localhost", "root", "admin123", "test_db", 3306);
public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get db(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // database operation
        sql:ParameterizedQuery dbQuery0 = `SELECT * FROM users;`;
        stream<Record, sql:Error?> dbStream0 = mySql_Config->query(dbQuery0);
        Record[] dbSelect0 = check from Record _iterator_ in dbStream0
            select _iterator_;
        ctx.payload = dbSelect0;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Db Input Parameters

**Input (db_input_parameters.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="c5d6e266-c387-4836-ab08-36aa28f37907" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <db:config name="mySql_Config" doc:name="Database Config" doc:id="7a100611-706e-41b9-9567-7853a11271a2" >
        <db:my-sql-connection host="localhost" port="3306" user="root" password="admin123" database="test_db" />
    </db:config>
    <flow name="demoFlow" doc:id="1d088811-dee1-455d-a909-529d3c54662f" >
        <http:listener doc:name="Listener" doc:id="758aa0e3-bd7e-43ab-8c4f-ed2dbde66aac" config-ref="config" path="/db" allowedMethods="GET"/>
        <db:select doc:name="Select" doc:id="5ac75c6d-de93-49aa-b7e9-5eaae0b94d4f" config-ref="mySql_Config" queryTimeout="34">
            <db:sql><![CDATA[SELECT * FROM users WHERE id = :id AND name = :name;]]></db:sql>
            <db:input-parameters><![CDATA[
        		#[{
            		'id': vars.userId,
            		'name': vars.userName
        		}]
    		]]></db:input-parameters>
        </db:select>
    </flow>
</mule>

```
**Output (db_input_parameters.bal):**
```ballerina
import ballerina/http;
import ballerina/sql;
import ballerinax/mysql;
import ballerinax/mysql.driver as _;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public type Record record {
};

mysql:Client mySql_Config = check new ("localhost", "root", "admin123", "test_db", 3306);
public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get db(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // database operation
        sql:ParameterizedQuery dbQuery0 = `SELECT * FROM users WHERE id = :id AND name = :name;`;
        stream<Record, sql:Error?> dbStream0 = mySql_Config->query(dbQuery0);

        // TODO: UNSUPPORTED MULE BLOCK ENCOUNTERED. MANUAL CONVERSION REQUIRED.
        // ------------------------------------------------------------------------
        // <db:input-parameters xmlns:db="http://www.mulesoft.org/schema/mule/db"><![CDATA[
        //         		#[{
        //             		'id': vars.userId,
        //             		'name': vars.userName
        //         		}]
        //     		]]></db:input-parameters>/n
        // ------------------------------------------------------------------------

        Record[] dbSelect0 = check from Record _iterator_ in dbStream0
            select _iterator_;
        ctx.payload = dbSelect0;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Generic Db Select

**Input (generic_db_select.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b5665e-0d10-42d8-905e-5ffda86655de" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <db:config name="mySql_Config" doc:name="Database Config" doc:id="8d8c1f02-b6f9-4f64-851c-960f5fa27a58" >
        <db:generic-connection url="jdbc:postgresql://localhost:5432/bookstore" user="root" password="admin"/>
    </db:config>
    <flow name="demoFlow" doc:id="49da2ab6-3074-48bb-b9fb-59ad876c4d6f" >
        <http:listener doc:name="Listener" doc:id="d7c2c6e0-73d7-4778-928b-97cb261fd173" config-ref="config" path="/db" allowedMethods="GET"/>
        <db:select doc:name="Select" doc:id="d8f552e7-25dd-46c0-a9e7-334b7ddea6d3" config-ref="mySql_Config">
            <db:sql ><![CDATA[SELECT * FROM users;]]></db:sql>
        </db:select>
    </flow>
</mule>

```
**Output (generic_db_select.bal):**
```ballerina
import ballerina/http;
import ballerina/sql;
import ballerinax/java.jdbc;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public type Record record {
};

jdbc:Client mySql_Config = check new ("jdbc:postgresql://localhost:5432/bookstore", "root", "admin");
public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get db(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // database operation
        sql:ParameterizedQuery dbQuery0 = `SELECT * FROM users;`;
        stream<Record, sql:Error?> dbStream0 = mySql_Config->query(dbQuery0);
        Record[] dbSelect0 = check from Record _iterator_ in dbStream0
            select _iterator_;
        ctx.payload = dbSelect0;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Oracle Db Select

**Input (oracle_db_select.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="f08109f3-5046-439c-a3e9-8e8dcd212005" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <db:config name="oracle_config" doc:name="Database Config" doc:id="26c3cfa7-455f-4760-9df6-8f2a490040a3" >
        <db:oracle-connection host="localhost" user="root" password="admin123" instance="test_db" port="1522"/>
    </db:config>
    <db:config name="oracle_config2" doc:name="Database Config" doc:id="69fb2643-c12f-49cd-9ca1-6c7011e219a2" >
        <db:oracle-connection host="#['localhost']" port="#[6063]" user="admin" password="nimda" serviceName="#['service_name']" />
    </db:config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="e5afb263-e428-44f3-adbb-be5f251b9621" config-ref="config" path="/db" allowedMethods="GET"/>
        <db:select doc:name="Select" doc:id="b946197c-a423-45ab-b8e4-0abb79a0e2b1" config-ref="oracle_config">
            <db:sql ><![CDATA[SELECT * FROM users;]]></db:sql>
        </db:select>
        <db:select doc:name="Select" doc:id="34a84d9b-1de8-4b21-9ece-36c20522ae0d" config-ref="oracle_config2">
            <db:sql ><![CDATA[SELECT * FROM persons;]]></db:sql>
        </db:select>
    </flow>
</mule>

```
**Output (oracle_db_select.bal):**
```ballerina
import ballerina/http;
import ballerina/sql;
import ballerinax/oracledb;
import ballerinax/oracledb.driver as _;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public type Record record {
};

oracledb:Client oracle_config = check new ("localhost", "root", "admin123", "test_db", 1522);
oracledb:Client oracle_config2 = check new ("localhost", "admin", "nimda", "service_name", 6063);
public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get db(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // database operation
        sql:ParameterizedQuery dbQuery0 = `SELECT * FROM users;`;
        stream<Record, sql:Error?> dbStream0 = oracle_config->query(dbQuery0);
        Record[] dbSelect0 = check from Record _iterator_ in dbStream0
            select _iterator_;
        ctx.payload = dbSelect0;

        // database operation
        sql:ParameterizedQuery dbQuery1 = `SELECT * FROM persons;`;
        stream<Record, sql:Error?> dbStream1 = oracle_config2->query(dbQuery1);
        Record[] dbSelect1 = check from Record _iterator_ in dbStream1
            select _iterator_;
        ctx.payload = dbSelect1;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## Error Handler

- ### Basic Error Handler

**Input (basic_error_handler.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <flow name="demoFlow" doc:id="604393a2-20fb-418b-9672-84c2febf6be4" >
        <set-payload value="#[1/0]" doc:name="Cause Error (Divide by Zero)" doc:id="2a4f136a-497a-4f72-aa9d-0bec782c6239" />
        <logger level="INFO" doc:name="Logger" doc:id="c492fc94-6338-4ed3-8ca8-472c2f4f4ad6" message="xxx: log after exception"/>
        <error-handler ref="my_error_handler" />
    </flow>
    <error-handler name="my_error_handler" doc:id="6a75f334-17ac-4c23-9856-32117be015d6" >
        <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="72999e22-2e4d-4371-b747-dc8ce627ea39">
            <logger level="INFO" doc:name="Logger" doc:id="88085ccb-999a-46eb-b3eb-768502bf2eeb" message="Error handled in on-error-propagate" />
            <set-payload value="#['Custom error message: Something went wrong.']" doc:name="Set Payload" doc:id="85a9ce5b-abb9-477a-859a-18a3ddf45ba8" />
        </on-error-propagate>
    </error-handler>
</mule>

```
**Output (basic_error_handler.bal):**
```ballerina
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

public function demoFlow(Context ctx) {
    do {

        // set payload
        anydata payload0 = 1 / 0;
        ctx.payload = payload0;
        log:printInfo("xxx: log after exception");
    } on fail error err {
        my_error_handler(ctx, err);
    }
}

public function my_error_handler(Context ctx, error e) {
    // on-error-propagate
    log:printError("Message: " + err.message());
    log:printError("Trace: " + err.stackTrace().toString());

    log:printInfo("Error handled in on-error-propagate");

    // set payload
    string payload1 = "Custom error message: Something went wrong.";
    ctx.payload = payload1;
    panic err;
}

```

- ### Error Handler With Conditions

**Input (error_handler_with_conditions.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="listener_config" doc:name="HTTP Listener config" doc:id="73a0fa89-f2fe-48ca-a692-eb28f9809a9c" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8083" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="604393a2-20fb-418b-9672-84c2febf6be4" >
        <http:listener doc:name="Listener" doc:id="0f4ad9ee-5c97-46eb-819d-8576f3cb125c" config-ref="listener_config" path="error_handler" allowedMethods="GET" />
        <set-payload value="#[1/0]" doc:name="Cause Error (Divide by Zero)" doc:id="2a4f136a-497a-4f72-aa9d-0bec782c6239" />
        <logger level="INFO" doc:name="Logger" doc:id="c492fc94-6338-4ed3-8ca8-472c2f4f4ad6" message="xxx: log after exception"/>
        <error-handler ref="my_error_handler" />
    </flow>
    <error-handler name="my_error_handler" doc:id="6a75f334-17ac-4c23-9856-32117be015d6" >
        <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="72999e22-2e4d-4371-b747-dc8ce627ea39" type="ANY" when="#[error.description contains 'timeout']">
            <logger level="INFO" doc:name="Logger" doc:id="88085ccb-999a-46eb-b3eb-768502bf2eeb" message="xxx: first error catch" />
        </on-error-propagate>
        <on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="41fa5d79-7006-4cb9-861d-e72826c00ae5" type="EXPRESSION">
            <logger level="INFO" doc:name="Logger" doc:id="720a9479-af93-49f5-972e-355785c135f7" message="xxx: second error catch"/>
        </on-error-continue>
        <on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="2536ea48-73be-443d-9d20-ac8f062f2bcf" when="#[error.cause.'type' == 'java.lang.NullPointerException']">
            <logger level="INFO" doc:name="Logger" doc:id="895923bb-1df1-4060-87c1-77a21b1e72ce" message="xxx: last error catch"/>
        </on-error-continue>
    </error-handler>
</mule>

```
**Output (error_handler_with_conditions.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener listener_config = new (8083);

service /mule4 on listener_config {
    resource function get error_handler(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        do {

            // set payload
            anydata payload0 = 1 / 0;
            ctx.payload = payload0;
            log:printInfo("xxx: log after exception");
        } on fail error err {
            my_error_handler(ctx, err);
        }

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

public function my_error_handler(Context ctx, error e) {
    // TODO: if conditions may require some manual adjustments
    if err is "ANY" && err.message() == "#[error.description contains 'timeout']" {

        // on-error-propagate

        log:printError("Message: " + err.message());
        log:printError("Trace: " + err.stackTrace().toString());

        log:printInfo("xxx: first error catch");
        ctx.attributes.response.statusCode = 500;
    } else if err is "EXPRESSION" {
        // on-error-continue
        log:printError("Message: " + err.message());
        log:printError("Trace: " + err.stackTrace().toString());

        log:printInfo("xxx: second error catch");
    } else if err.message() == "#[error.cause.'type' == 'java.lang.NullPointerException']" {
        // on-error-continue
        log:printError("Message: " + err.message());
        log:printError("Trace: " + err.stackTrace().toString());

        log:printInfo("xxx: last error catch");
    }
}

```

- ### Error Handler With Http Listener Source

**Input (error_handler_with_http_listener_source.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="listener_config" doc:name="HTTP Listener config" doc:id="73a0fa89-f2fe-48ca-a692-eb28f9809a9c" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8083" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="604393a2-20fb-418b-9672-84c2febf6be4" >
        <http:listener doc:name="Listener" doc:id="0f4ad9ee-5c97-46eb-819d-8576f3cb125c" config-ref="listener_config" path="error_handler" allowedMethods="GET" />
        <set-payload value="#[1/0]" doc:name="Cause Error (Divide by Zero)" doc:id="2a4f136a-497a-4f72-aa9d-0bec782c6239" />
        <logger level="INFO" doc:name="Logger" doc:id="c492fc94-6338-4ed3-8ca8-472c2f4f4ad6" message="xxx: log after exception"/>
        <error-handler ref="my_error_handler" />
    </flow>
    <error-handler name="my_error_handler" doc:id="6a75f334-17ac-4c23-9856-32117be015d6" >
        <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="72999e22-2e4d-4371-b747-dc8ce627ea39">
            <logger level="INFO" doc:name="Logger" doc:id="88085ccb-999a-46eb-b3eb-768502bf2eeb" message="Error handled in on-error-propagate" />
            <set-payload value="#['Custom error message: Something went wrong.']" doc:name="Set Payload" doc:id="85a9ce5b-abb9-477a-859a-18a3ddf45ba8" />
        </on-error-propagate>
    </error-handler>
</mule>

```
**Output (error_handler_with_http_listener_source.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener listener_config = new (8083);

service /mule4 on listener_config {
    resource function get error_handler(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        do {

            // set payload
            anydata payload0 = 1 / 0;
            ctx.payload = payload0;
            log:printInfo("xxx: log after exception");
        } on fail error err {
            my_error_handler(ctx, err);
        }

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

public function my_error_handler(Context ctx, error e) {
    // on-error-propagate
    log:printError("Message: " + err.message());
    log:printError("Trace: " + err.stackTrace().toString());

    log:printInfo("Error handled in on-error-propagate");

    // set payload
    string payload1 = "Custom error message: Something went wrong.";
    ctx.payload = payload1;
    ctx.attributes.response.statusCode = 500;
}

```

## Expression Component

- ### Simple Expression Component

**Input (simple_expression_component.xml):**
```xml
<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
      xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:spring="http://www.springframework.org/schema/beans" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd">
    <flow name="combineFlowVarsAndPayloadFlow">
        <set-variable variableName="name" value="Alice"/>
        <set-payload value="Welcome"/>
        <expression-component>
            <![CDATA[
                flowVars.name = "Alice";
                payload = "Hello " + flowVars.name;
            ]]>
        </expression-component>
        <logger message="Message: #[payload]" level="INFO"/>
    </flow>
</mule>

```
**Output (simple_expression_component.bal):**
```ballerina
import ballerina/log;

public type FlowVars record {|
    string name?;
|};

public type Context record {|
    anydata payload = ();
    FlowVars flowVars = {};
|};

public function combineFlowVarsAndPayloadFlow(Context ctx) {
    ctx.flowVars.name = "Alice";

    // set payload
    string payload0 = "Welcome";
    ctx.payload = payload0;
    ctx.flowVars.name = "Alice";
    ctx.payload = "Hello " + ctx.flowVars.name;
    log:printInfo(string `Message: ${ctx.payload.toString()}`);
}

```

## First Successful

- ### Basic First Successful

**Input (basic_first_successful.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
        http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
        http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">

    <flow name="scatterGatherFlow">
        <http:listener config-ref="http_listener" path="/first_successful" doc:name="HTTP Listener"/>
        <first-successful doc:name="First Successful" doc:id="a756b895-8c82-469a-b10a-d622b379cf8d" >
            <route >
                <set-payload value="Route 0 completed" doc:name="Set Payload 1" />
            </route>
            <route >
                <set-payload value="Route 1 completed" doc:name="Set Payload 2" />
            </route>
            <route >
                <set-payload value="Route 2 completed" doc:name="Set Payload 3" />
            </route>
        </first-successful>
        <logger level="INFO" message="#[payload]" doc:name="Logger"/>
    </flow>

    <http:listener-config name="http_listener" doc:name="HTTP Listener config">
        <http:listener-connection host="0.0.0.0" port="9090"/>
    </http:listener-config>
</mule>

```
**Output (basic_first_successful.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener http_listener = new (9090);

service / on http_listener {
    resource function default first_successful(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // first-successful sequential route execution
        anydata firstSuccessfulResult0 = check firstSuccessful0(ctx);
        ctx.payload = firstSuccessfulResult0;

        log:printInfo(ctx.payload.toString());

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

public function route1(Context ctx) returns anydata|error {
    // Route 1

    // set payload
    string payload1 = "Route 1 completed";
    ctx.payload = payload1;
    return ctx.payload;
}

public function firstSuccessful0(Context ctx) returns anydata|error {
    anydata|error r0 = route0(ctx);
    if r0 !is error {
        return r0;
    }
    anydata|error r1 = route1(ctx);
    if r1 !is error {
        return r1;
    }
    anydata|error r2 = route2(ctx);
    if r2 !is error {
        return r2;
    }
    return error("All routes failed", r2);
}

public function route2(Context ctx) returns anydata|error {
    // Route 2

    // set payload
    string payload2 = "Route 2 completed";
    ctx.payload = payload2;
    return ctx.payload;
}

public function route0(Context ctx) returns anydata|error {
    // Route 0

    // set payload
    string payload0 = "Route 0 completed";
    ctx.payload = payload0;
    return ctx.payload;
}

```

## Flow

- ### Basic Flow

**Input (basic_flow.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/flow" allowedMethods="GET"/>
        <logger level="INFO" doc:name="Logger" doc:id="af520ce8-f697-4442-8729-866a2a6ae7a4" message="xxx: logger invoked via http end point"/>
    </flow>
</mule>

```
**Output (basic_flow.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get flow(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked via http end point");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Private Flow

**Input (private_flow.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoPrivateFlow" doc:id="7ef1d386-6d32-46ce-940a-4865603b13ea" >
        <logger level="INFO" doc:name="Logger" doc:id="389470bd-5fc3-4928-adbb-3177c38bccc4" message="xxx: private flow invoked"/>
    </flow>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/flow" allowedMethods="GET"/>
        <logger level="INFO" doc:name="Logger" doc:id="af520ce8-f697-4442-8729-866a2a6ae7a4" message="xxx: logger invoked via http end point"/>
        <flow-ref doc:name="Flow Reference" doc:id="6022619f-49d4-4928-bfbf-ab4d31bc9b49" name="demoPrivateFlow"/>
        <logger level="INFO" doc:name="Logger" doc:id="59bcdc96-fdd3-45b7-82b7-91fc9a85a366" message="xxx: end of main flow"/>
    </flow>
</mule>

```
**Output (private_flow.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get flow(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked via http end point");
        demoPrivateFlow(ctx);
        log:printInfo("xxx: end of main flow");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

public function demoPrivateFlow(Context ctx) {
    log:printInfo("xxx: private flow invoked");
}

```

## For Each

- ### Basic For Each

**Input (basic_for_each.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
    <http:listener-config name="HTTP_Listener_config">
        <http:listener-connection host="0.0.0.0" port="9090" />
    </http:listener-config>
    <flow name="muleDemoFlow">
        <http:listener path="/demo" config-ref="HTTP_Listener_config" allowedMethods="POST"/>
        <set-payload value='["Alice", "Bob", "Charlie"]' doc:name="Set Payload" doc:id="001d4ca9-4add-45e9-9c63-d4a70bbe7760" mimeType="application/json"/>
        <foreach doc:name="For Each" doc:id="4810884b-2b96-4a39-a478-fb3a37ad5a63" >
            <logger level="INFO" doc:name="Logger" doc:id="aa9fee20-cdaf-4649-8d9c-1eec98ec6a90" message="Current item: #[payload]"/>
        </foreach>
    </flow>
</mule>

```
**Output (basic_for_each.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener HTTP_Listener_config = new (9090);

service / on HTTP_Listener_config {
    resource function post demo(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // set payload
        string payload0 = "[\"Alice\", \"Bob\", \"Charlie\"]";
        ctx.payload = payload0;

        // foreach loop
        anydata originalPayload0 = ctx.payload;
        foreach anydata item0 in ctx.payload {
            ctx.payload = item0;
            log:printInfo(string `Current item: ${ctx.payload.toString()}`);
        }
        ctx.payload = originalPayload0;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## Http Listener

- ### Allowed Resource Default Methods

**Input (allowed_resource_default_methods.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="demo"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (allowed_resource_default_methods.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function default demo(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Allowed Resource Multiple Methods

**Input (allowed_resource_multiple_methods.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET, POST, DELETE" path="/"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (allowed_resource_multiple_methods.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get .(http:Request request) returns http:Response|error {
        return invokeEndPoint0(request);
    }

    resource function post .(http:Request request) returns http:Response|error {
        return invokeEndPoint0(request);
    }

    resource function delete .(http:Request request) returns http:Response|error {
        return invokeEndPoint0(request);
    }
}

public function invokeEndPoint0(http:Request request) returns http:Response|error {
    Context ctx = {attributes: {request, response: new}};
    log:printInfo("xxx: logger invoked");

    ctx.attributes.response.setPayload(ctx.payload);
    return ctx.attributes.response;
}

```

- ### Allowed Resource Post Method

**Input (allowed_resource_post_method.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="POST" path="/"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (allowed_resource_post_method.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function post .(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Basic Http Listener

**Input (basic_http_listener.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="/mule4" >
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET" path="/demo"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (basic_http_listener.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get demo(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Empty Absolute And Resource Paths

**Input (empty_absolute_and_resource_paths.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET" path="/"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (empty_absolute_and_resource_paths.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service / on config {
    resource function get .(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Empty Absolute Path

**Input (empty_absolute_path.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET" path="/demo"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (empty_absolute_path.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service / on config {
    resource function get demo(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Empty Resource Path

**Input (empty_resource_path.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET" path="/"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (empty_resource_path.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get .(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Http Listener Attributes

**Input (http_listener_attributes.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/attribute_test/{country}/v1" allowedMethods="GET"/>
        <set-variable value="#[attributes.queryParams]" doc:name="Set Query Params Variable" doc:id="18c52daa-b688-4927-a50a-be5bdff893ef" variableName="queryParams"/>
        <set-variable value="#[attributes['queryParams']]" doc:name="Set Query Params2 Variable" doc:id="18c52daa-b688-4927-a50a-be5bdff893ef" variableName="queryParams2"/>
        <set-variable value="#[attributes.queryParams.city]" doc:name="Set City Variable" doc:id="0a4e42a3-6eff-47cc-a93e-bb839feb261e" variableName="city"/>
        <set-variable value="#[attributes['queryParams'].city]" doc:name="Set City2 Variable" doc:id="0a4e42a3-6eff-47cc-a93e-bb839feb261e" variableName="city2"/>
        <set-variable value="#[attributes.uriParams]" doc:name="Set Uri Params Variable" doc:id="0fbdf860-e2be-4f8d-8cc0-018b20915110" variableName="uriParams"/>
        <set-variable value="#[attributes.uriParams.country]" doc:name="Set Country Variable" doc:id="e5af65e9-2cba-49b3-b242-39d68cbd0670" variableName="country"/>
        <set-variable value="#[attributes.unsupportedAttribute]" doc:name="Set Unsupported Attribute Variable" doc:id="2e9f9576-af2c-4441-b22b-36b57f45f2f3" variableName="unsupportedAttribute"/>
        <set-variable value="#[attributes.unsupportedAttribute.city]" doc:name="Set Unsupported Attribute Access Variable" doc:id="97575d11-1194-4ebf-a2f1-6706de417dbb" variableName="unsupportedAttributeAccess"/>
        <set-variable value="#[attributes.method]" doc:name="Set Http Method Variable" doc:id="2deb05da-de20-4911-9736-dc388a2edbc6" variableName="httpMethod"/>
    </flow>
</mule>

```
**Output (http_listener_attributes.bal):**
```ballerina
import ballerina/http;

public type Vars record {|
    map<string[]> queryParams?;
    map<string[]> queryParams2?;
    string city?;
    string city2?;
    map<string> uriParams?;
    string country?;
    anydata unsupportedAttribute?;
    anydata unsupportedAttributeAccess?;
    anydata httpMethod?;
|};

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Vars vars = {};
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get attribute_test/[string country]/v1(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new, uriParams: {country}}};
        ctx.vars.queryParams = ctx.attributes.request.getQueryParams();
        ctx.vars.queryParams2 = ctx.attributes.request.getQueryParams();
        ctx.vars.city = ctx.attributes.request.getQueryParamValue("city");
        ctx.vars.city2 = ctx.attributes.request.getQueryParamValue("city");
        ctx.vars.uriParams = ctx.attributes.uriParams;
        ctx.vars.country = ctx.attributes.uriParams.get("country");
        ctx.vars.unsupportedAttribute = ctx.attributes["unsupportedAttribute"];
        ctx.vars.unsupportedAttributeAccess = ctx.attributes["unsupportedAttribute"].city;
        ctx.vars.httpMethod = ctx.attributes.request.method;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Http Listener With Localhost

**Input (http_listener_with_localhost.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="localhost" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET" path="/demo"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (http_listener_with_localhost.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081, {host: "localhost"});

service /mule4 on config {
    resource function get demo(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Query Params

**Input (query_params.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET" path="/test_query"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
        <logger level="INFO" doc:name="Logger" doc:id="76c17b85-33b9-4fc4-b5dc-27b79aa703e9" message="Path params - version: #[attributes.queryParams.country], id: #[attributes.queryParams.city]"/>
    </flow>
</mule>

```
**Output (query_params.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get test_query(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");
        log:printInfo(string `Path params - version: ${ctx.attributes.request.getQueryParamValue("country").toString()}, id: ${ctx.attributes.request.getQueryParamValue("city").toString()}`);

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Resource Uri Params

**Input (resource_uri_params.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET" path="/{version}/demo/{id}"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
        <logger level="INFO" doc:name="Logger" doc:id="76c17b85-33b9-4fc4-b5dc-27b79aa703e9" message="Path params - version: #[attributes.uriParams.version], id: #[attributes.uriParams.id]"/>
    </flow>
</mule>

```
**Output (resource_uri_params.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get [string version]/demo/[string id](http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new, uriParams: {version, id}}};
        log:printInfo("xxx: logger invoked");
        log:printInfo(string `Path params - version: ${ctx.attributes.uriParams.get("version").toString()}, id: ${ctx.attributes.uriParams.get("id").toString()}`);

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Special Characters In Resource Path

**Input (special_characters_in_resource_path.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" allowedMethods="GET" path="/v-1/demo/1.0/main-contract/new"/>
        <logger level="INFO" doc:name="Logger" doc:id="c56aad96-6335-49a3-9b27-6d2b5ab0a963" message="xxx: logger invoked"/>
    </flow>
</mule>

```
**Output (special_characters_in_resource_path.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get v\-1/demo/'1\.0/main\-contract/'new(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## Http Request

- ### Basic Http Request

**Input (basic_http_request.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:request-config name="http_request_config" doc:name="HTTP Request configuration" doc:id="1e0d78e1-e5fb-44a9-9b18-b86c0d151be6" >
        <http:request-connection host="jsonplaceholder.typicode.com" port="80" />
    </http:request-config>
    <flow name="demoFlow" doc:id="1d088811-dee1-455d-a909-529d3c54662f" >
        <http:request method="GET" doc:name="Request" doc:id="b91d51d7-5c26-40a3-8ec5-66426b32989e" config-ref="http_request_config" path="/posts/latest"/>
        <logger level="INFO" doc:name="Logger" doc:id="d0390e1c-7a02-44af-87b0-41f9834a6158" message="Received from external API: #[payload]"/>
    </flow>
</mule>

```
**Output (basic_http_request.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

public function demoFlow(Context ctx) {

    // http client request
    http:Client http_request_config = check new ("jsonplaceholder.typicode.com:80");
    http:Response clientResult0 = check http_request_config->/posts/latest.get();
    ctx.payload = check clientResult0.getJsonPayload();
    log:printInfo(string `Received from external API: ${ctx.payload.toString()}`);
}

```

- ### Http Request Path With Special Characters

**Input (http_request_path_with_special_characters.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:request-config name="http_request_config" doc:name="HTTP Request configuration" doc:id="1e0d78e1-e5fb-44a9-9b18-b86c0d151be6" >
        <http:request-connection host="jsonplaceholder.typicode.com" port="80" protocol="HTTPS"/>
    </http:request-config>
    <flow name="demoFlow" doc:id="1d088811-dee1-455d-a909-529d3c54662f" >
        <http:request method="GET" doc:name="Request" doc:id="b91d51d7-5c26-40a3-8ec5-66426b32989e" config-ref="http_request_config" path="/car-posts/12/honda-civic/991/1.1/latest"/>
        <logger level="INFO" doc:name="Logger" doc:id="d0390e1c-7a02-44af-87b0-41f9834a6158" message="Received from external API: #[payload]"/>
    </flow>
</mule>

```
**Output (http_request_path_with_special_characters.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

public function demoFlow(Context ctx) {

    // http client request
    http:Client http_request_config = check new ("https://jsonplaceholder.typicode.com:80");
    http:Response clientResult0 = check http_request_config->/car\-posts/'12/honda\-civic/'991/'1\.1/latest.get();
    ctx.payload = check clientResult0.getJsonPayload();
    log:printInfo(string `Received from external API: ${ctx.payload.toString()}`);
}

```

- ### Http Request With Http Source

**Input (http_request_with_http_source.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="listener_config" doc:name="HTTP Listener config"
                          doc:id="c5d6e266-c387-4836-ab08-36aa28f37907" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <http:request-config name="http_request_config" doc:name="HTTP Request configuration" doc:id="1e0d78e1-e5fb-44a9-9b18-b86c0d151be6" >
        <http:request-connection host="jsonplaceholder.typicode.com" port="80" protocol="HTTPS"/>
    </http:request-config>
    <flow name="demoFlow" doc:id="1d088811-dee1-455d-a909-529d3c54662f" >
        <http:listener doc:name="Listener" doc:id="758aa0e3-bd7e-43ab-8c4f-ed2dbde66aac" config-ref="listener_config" path="/http_request" allowedMethods="GET"/>
        <http:request method="GET" doc:name="Request" doc:id="b91d51d7-5c26-40a3-8ec5-66426b32989e" config-ref="http_request_config" path="/posts/latest"/>
        <logger level="INFO" doc:name="Logger" doc:id="d0390e1c-7a02-44af-87b0-41f9834a6158" message="Received from external API: #[payload]"/>
    </flow>
</mule>

```
**Output (http_request_with_http_source.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener listener_config = new (8081);

service /mule4 on listener_config {
    resource function get http_request(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // http client request
        http:Client http_request_config = check new ("https://jsonplaceholder.typicode.com:80");
        http:Response clientResult0 = check http_request_config->/posts/latest.get();
        ctx.payload = check clientResult0.getJsonPayload();
        log:printInfo(string `Received from external API: ${ctx.payload.toString()}`);

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Http Request With Url Property

**Input (http_request_with_url_property.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:request-config name="http_request_config" doc:name="HTTP Request configuration" doc:id="1e0d78e1-e5fb-44a9-9b18-b86c0d151be6" >
        <http:request-connection host="jsonplaceholder.typicode.com" port="80" protocol="HTTPS"/>
    </http:request-config>
    <flow name="demoFlow" doc:id="1d088811-dee1-455d-a909-529d3c54662f" >
        <http:request method="GET" doc:name="Request" doc:id="b91d51d7-5c26-40a3-8ec5-66426b32989e" config-ref="http_request_config" url="https://jsonplaceholder.typicode.com/todos/1"/>
        <logger level="INFO" doc:name="Logger" doc:id="d0390e1c-7a02-44af-87b0-41f9834a6158" message="Received from external API: #[payload]"/>
    </flow>
</mule>

```
**Output (http_request_with_url_property.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

public function demoFlow(Context ctx) {

    // http client request
    http:Client http_request_config = check new ("https://jsonplaceholder.typicode.com/todos/1");
    http:Response clientResult0 = check http_request_config->/.get();
    ctx.payload = check clientResult0.getJsonPayload();
    log:printInfo(string `Received from external API: ${ctx.payload.toString()}`);
}

```

## Logger

- ### Basic Logger

**Input (basic_logger.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/logger" allowedMethods="GET"/>
        <logger level="INFO" doc:name="Logger" doc:id="af520ce8-f697-4442-8729-866a2a6ae7a4" message="xxx: first logger invoked"/>
        <logger level="INFO" doc:name="Logger" doc:id="b476f2a5-cd98-47f8-b291-b5f153e13738" message="xxx: second logger invoked"/>
    </flow>
</mule>

```
**Output (basic_logger.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get logger(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: first logger invoked");
        log:printInfo("xxx: second logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Logger Levels

**Input (logger_levels.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/logger" allowedMethods="GET"/>
        <logger level="INFO" doc:name="Logger" doc:id="af520ce8-f697-4442-8729-866a2a6ae7a4" message="xxx: INFO level logger invoked"/>
        <logger level="DEBUG" doc:name="Logger" doc:id="b476f2a5-cd98-47f8-b291-b5f153e13738" message="xxx: DEBUG level logger invoked"/>
        <logger level="ERROR" doc:name="Logger" doc:id="a4f13466-9499-41f0-830b-783ac39c448c" message="xxx: ERROR level logger invoked"/>
        <logger level="WARN" doc:name="Logger" doc:id="80b34917-3d6b-4596-8260-9ad085b316fd" message="xxx: WARN level logger invoked"/>
        <logger level="TRACE" doc:name="Logger" doc:id="9f60cebc-7a91-451e-86ff-713b15d120c9" message="xxx: TRACE level logger invoked"/>
    </flow>
</mule>

```
**Output (logger_levels.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get logger(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: INFO level logger invoked");
        log:printDebug("xxx: DEBUG level logger invoked");
        log:printError("xxx: ERROR level logger invoked");
        log:printWarn("xxx: WARN level logger invoked");
        log:printInfo("xxx: TRACE level logger invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## Message Enricher

- ### Empty Message Enricher

**Input (empty_message_enricher.xml):**
```xml
<mule xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:spring="http://www.springframework.org/schema/beans" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd">

    <flow name="variableEnricherFlow">
        <set-variable variableName="userId" value="st455u" doc:name="Variable"/>
        <set-variable variableName="enrichedUserId" value="null" doc:name="Variable"/>
        <enricher source="#[flowVars.userId]" target="#[flowVars.enrichedUserId]" doc:name="Message Enricher">
        </enricher>
        <logger message="User ID: #[flowVars.userId], Enriched User ID: #[flowVars.enrichedUserId]" level="INFO" doc:name="Logger"/>
    </flow>

</mule>

```
**Output (empty_message_enricher.bal):**
```ballerina
import ballerina/log;

public type FlowVars record {|
    string userId?;
    string enrichedUserId?;
|};

public type Context record {|
    anydata payload = ();
    FlowVars flowVars = {};
|};

public function variableEnricherFlow(Context ctx) {
    ctx.flowVars.userId = "st455u";
    ctx.flowVars.enrichedUserId = "null";
    ctx.flowVars.enrichedUserId = ctx.flowVars.userId;
    log:printInfo(string `User ID: ${ctx.flowVars.userId.toString()}, Enriched User ID: ${ctx.flowVars.enrichedUserId.toString()}`);
}

```

- ### Enricher With Inside Flow Reference

**Input (enricher_with_inside_flow_reference.xml):**
```xml
<mule xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:spring="http://www.springframework.org/schema/beans" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd">

    <flow name="variableEnricherFlow">
        <set-variable variableName="userId" value="st455u" doc:name="Variable"/>
        <set-variable variableName="enrichedUserId" value="null" doc:name="Variable"/>
        <enricher source="#[flowVars.userId]" target="#[flowVars.enrichedUserId]" doc:name="Message Enricher">
            <flow-ref name="flow1" doc:name="Flow Reference"/>
        </enricher>
        <logger message="User ID: #[flowVars.userId], Enriched User ID: #[flowVars.enrichedUserId]" level="INFO" doc:name="Logger"/>
    </flow>
    <flow name="flow1">
        <logger message="xxx: flow1 starting logger invkoed" level="INFO" doc:name="Logger"/>
        <logger message="xxx: end of flow1 reached" level="INFO" doc:name="Logger"/>
    </flow>

</mule>

```
**Output (enricher_with_inside_flow_reference.bal):**
```ballerina
import ballerina/log;

public type FlowVars record {|
    string userId?;
    string enrichedUserId?;
|};

public type Context record {|
    anydata payload = ();
    FlowVars flowVars = {};
|};

public function variableEnricherFlow(Context ctx) {
    ctx.flowVars.userId = "st455u";
    ctx.flowVars.enrichedUserId = "null";
    ctx.flowVars.enrichedUserId = enricher0(ctx.clone());
    log:printInfo(string `User ID: ${ctx.flowVars.userId.toString()}, Enriched User ID: ${ctx.flowVars.enrichedUserId.toString()}`);
}

public function enricher0(Context ctx) returns string? {
    flow1(ctx);
    return ctx.flowVars.userId;
}

public function flow1(Context ctx) {
    log:printInfo("xxx: flow1 starting logger invkoed");
    log:printInfo("xxx: end of flow1 reached");
}

```

- ### Enricher With Inside Logger

**Input (enricher_with_inside_logger.xml):**
```xml
<mule xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:spring="http://www.springframework.org/schema/beans" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd">

    <flow name="variableEnricherFlow">
        <set-variable variableName="userId" value="st455u" doc:name="Variable"/>
        <set-variable variableName="enrichedUserId" value="null" doc:name="Variable"/>
        <enricher source="#[flowVars.userId]" target="#[flowVars.enrichedUserId]" doc:name="Message Enricher">
            <logger message="xxx: logger inside the message enricher invoked" level="INFO" doc:name="Logger"/>
        </enricher>
        <logger message="User ID: #[flowVars.userId], Enriched User ID: #[flowVars.enrichedUserId]" level="INFO" doc:name="Logger"/>
    </flow>

</mule>

```
**Output (enricher_with_inside_logger.bal):**
```ballerina
import ballerina/log;

public type FlowVars record {|
    string userId?;
    string enrichedUserId?;
|};

public type Context record {|
    anydata payload = ();
    FlowVars flowVars = {};
|};

public function variableEnricherFlow(Context ctx) {
    ctx.flowVars.userId = "st455u";
    ctx.flowVars.enrichedUserId = "null";
    ctx.flowVars.enrichedUserId = enricher0(ctx.clone());
    log:printInfo(string `User ID: ${ctx.flowVars.userId.toString()}, Enriched User ID: ${ctx.flowVars.enrichedUserId.toString()}`);
}

public function enricher0(Context ctx) returns string? {
    log:printInfo("xxx: logger inside the message enricher invoked");
    return ctx.flowVars.userId;
}

```

## Object To Json

- ### Basic Object To Json

**Input (basic_object_to_json.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:json="http://www.mulesoft.org/schema/mule/json" xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:spring="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd
http://www.mulesoft.org/schema/mule/json http://www.mulesoft.org/schema/mule/json/current/mule-json.xsd">
    <http:listener-config name="config" host="0.0.0.0" port="8081"  doc:name="HTTP Listener Configuration" basePath="mule3"/>
    <db:mysql-config name="MySQL_Configuration" host="localhost" port="3306" user="root" password="admin123" database="test_db" doc:name="MySQL Configuration"/>
    <flow name="demoFlow">
        <http:listener config-ref="config" path="/" allowedMethods="GET" doc:name="HTTP"/>
        <db:select config-ref="MySQL_Configuration" doc:name="Database">
            <db:parameterized-query><![CDATA[SELECT * FROM users;]]></db:parameterized-query>
        </db:select>
        <json:object-to-json-transformer doc:name="Object to JSON"/>
    </flow>
</mule>

```
**Output (basic_object_to_json.bal):**
```ballerina
import ballerina/http;
import ballerina/sql;
import ballerinax/mysql;
import ballerinax/mysql.driver as _;

public type InboundProperties record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    InboundProperties inboundProperties;
|};

public type Record record {
};

mysql:Client MySQL_Configuration = check new ("localhost", "root", "admin123", "test_db", 3306);
public listener http:Listener config = new (8081);

service /mule3 on config {
    resource function get .(http:Request request) returns http:Response|error {
        Context ctx = {inboundProperties: {request, response: new}};

        // database operation
        sql:ParameterizedQuery dbQuery0 = `SELECT * FROM users;`;
        stream<Record, sql:Error?> dbStream0 = MySQL_Configuration->query(dbQuery0);
        Record[] dbSelect0 = check from Record _iterator_ in dbStream0
            select _iterator_;
        ctx.payload = dbSelect0;

        // json transformation
        ctx.payload = ctx.payload.toJson();

        ctx.inboundProperties.response.setPayload(ctx.payload);
        return ctx.inboundProperties.response;
    }
}

```

## Object To String

- ### Basic Object To String

**Input (basic_object_to_string.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:json="http://www.mulesoft.org/schema/mule/json" xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:spring="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd
http://www.mulesoft.org/schema/mule/json http://www.mulesoft.org/schema/mule/json/current/mule-json.xsd">
    <http:listener-config name="config" host="0.0.0.0" port="8081"  doc:name="HTTP Listener Configuration" basePath="mule3"/>
    <db:mysql-config name="MySQL_Configuration" host="localhost" port="3306" user="root" password="admin123" database="test_db" doc:name="MySQL Configuration"/>
    <flow name="demoFlow">
        <http:listener config-ref="config" path="/" allowedMethods="GET" doc:name="HTTP"/>
        <db:select config-ref="MySQL_Configuration" doc:name="Database">
            <db:parameterized-query><![CDATA[SELECT * FROM users;]]></db:parameterized-query>
        </db:select>
        <object-to-string-transformer doc:name="Object to String"/>
    </flow>
</mule>

```
**Output (basic_object_to_string.bal):**
```ballerina
import ballerina/http;
import ballerina/sql;
import ballerinax/mysql;
import ballerinax/mysql.driver as _;

public type InboundProperties record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    InboundProperties inboundProperties;
|};

public type Record record {
};

mysql:Client MySQL_Configuration = check new ("localhost", "root", "admin123", "test_db", 3306);
public listener http:Listener config = new (8081);

service /mule3 on config {
    resource function get .(http:Request request) returns http:Response|error {
        Context ctx = {inboundProperties: {request, response: new}};

        // database operation
        sql:ParameterizedQuery dbQuery0 = `SELECT * FROM users;`;
        stream<Record, sql:Error?> dbStream0 = MySQL_Configuration->query(dbQuery0);
        Record[] dbSelect0 = check from Record _iterator_ in dbStream0
            select _iterator_;
        ctx.payload = dbSelect0;

        // string transformation
        ctx.payload = ctx.payload.toString();

        ctx.inboundProperties.response.setPayload(ctx.payload);
        return ctx.inboundProperties.response;
    }
}

```

## On Error Continue

- ### Basic On Error Continue

**Input (basic_on_error_continue.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <flow name="demoFlow" doc:id="9673c565-4e92-468d-92fa-417064ccc5c4" >
        <set-payload value="#[1/0]" doc:name="Cause Error (Divide by Zero)" doc:id="b2647e2e-af69-49ce-a30d-254e505d9e90" />
        <logger level="INFO" doc:name="Logger" doc:id="bd022374-be6b-49cf-82d9-4355a55a91cb" message="xxx: log after exception" />
        <error-handler >
            <on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="11e861b2-f2a4-4f60-b4ca-6a8e3e81bbcc" >
                <logger level="INFO" doc:name="Logger" doc:id="822ae64f-26f3-448d-a0d2-c0d7830085bd" message="xxx: error handled in on-error-continue"/>
                <set-payload value="#['Default value: Error occurred but we handled it.']" doc:name="Set Payload" doc:id="6aa1bb7f-bf42-4fa1-9e39-caf5dcc1e25f" />
            </on-error-continue>
        </error-handler>
    </flow>
</mule>

```
**Output (basic_on_error_continue.bal):**
```ballerina
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

public function demoFlow(Context ctx) {
    do {

        // set payload
        anydata payload0 = 1 / 0;
        ctx.payload = payload0;
        log:printInfo("xxx: log after exception");
    } on fail error err {
        // on-error-continue
        log:printError("Message: " + err.message());
        log:printError("Trace: " + err.stackTrace().toString());

        log:printInfo("xxx: error handled in on-error-continue");

        // set payload
        string payload1 = "Default value: Error occurred but we handled it.";
        ctx.payload = payload1;
    }
}

```

- ### On Error Continue With Http Listener Source

**Input (on_error_continue_with_http_listener_source.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="listener_config" doc:name="HTTP Listener config" doc:id="73a0fa89-f2fe-48ca-a692-eb28f9809a9c" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="9673c565-4e92-468d-92fa-417064ccc5c4" >
        <http:listener doc:name="Listener" doc:id="3e4b563f-edc5-4d60-ada8-c2ee3f97725e" config-ref="listener_config" allowedMethods="GET" path="on_error_continue"/>
        <set-payload value="#[1/0]" doc:name="Cause Error (Divide by Zero)" doc:id="b2647e2e-af69-49ce-a30d-254e505d9e90" />
        <logger level="INFO" doc:name="Logger" doc:id="bd022374-be6b-49cf-82d9-4355a55a91cb" message="xxx: log after exception" />
        <error-handler >
            <on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="11e861b2-f2a4-4f60-b4ca-6a8e3e81bbcc" >
                <logger level="INFO" doc:name="Logger" doc:id="822ae64f-26f3-448d-a0d2-c0d7830085bd" message="xxx: error handled in on-error-continue"/>
                <set-payload value="#['Default value: Error occurred but we handled it.']" doc:name="Set Payload" doc:id="6aa1bb7f-bf42-4fa1-9e39-caf5dcc1e25f" />
            </on-error-continue>
        </error-handler>
    </flow>
</mule>

```
**Output (on_error_continue_with_http_listener_source.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener listener_config = new (8081);

service /mule4 on listener_config {
    resource function get on_error_continue(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        do {

            // set payload
            anydata payload0 = 1 / 0;
            ctx.payload = payload0;
            log:printInfo("xxx: log after exception");
        } on fail error err {
            // on-error-continue
            log:printError("Message: " + err.message());
            log:printError("Trace: " + err.stackTrace().toString());

            log:printInfo("xxx: error handled in on-error-continue");

            // set payload
            string payload1 = "Default value: Error occurred but we handled it.";
            ctx.payload = payload1;
        }

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## On Error Propagate

- ### Basic On Error Propagate

**Input (basic_on_error_propagate.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <flow name="demoFlow" doc:id="604393a2-20fb-418b-9672-84c2febf6be4" >
        <set-payload value="#[1/0]" doc:name="Cause Error (Divide by Zero)" doc:id="2a4f136a-497a-4f72-aa9d-0bec782c6239" />
        <logger level="INFO" doc:name="Logger" doc:id="c492fc94-6338-4ed3-8ca8-472c2f4f4ad6" message="xxx: log after exception"/>
        <error-handler >
            <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="72999e22-2e4d-4371-b747-dc8ce627ea39" >
                <logger level="INFO" doc:name="Logger" doc:id="88085ccb-999a-46eb-b3eb-768502bf2eeb" message="Error handled in on-error-propagate"/>
                <set-payload value="#['Custom error message: Something went wrong.']" doc:name="Set Payload" doc:id="85a9ce5b-abb9-477a-859a-18a3ddf45ba8" />
            </on-error-propagate>
        </error-handler>
    </flow>
</mule>

```
**Output (basic_on_error_propagate.bal):**
```ballerina
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

public function demoFlow(Context ctx) {
    do {

        // set payload
        anydata payload0 = 1 / 0;
        ctx.payload = payload0;
        log:printInfo("xxx: log after exception");
    } on fail error err {
        // on-error-propagate
        log:printError("Message: " + err.message());
        log:printError("Trace: " + err.stackTrace().toString());

        log:printInfo("Error handled in on-error-propagate");

        // set payload
        string payload1 = "Custom error message: Something went wrong.";
        ctx.payload = payload1;
        panic err;
    }
}

```

- ### On Error Propagate With Http Listener Source

**Input (on_error_propagate_with_http_listener_source.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="listener_config" doc:name="HTTP Listener config" doc:id="73a0fa89-f2fe-48ca-a692-eb28f9809a9c" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8083" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="604393a2-20fb-418b-9672-84c2febf6be4" >
        <http:listener doc:name="Listener" doc:id="0f4ad9ee-5c97-46eb-819d-8576f3cb125c" config-ref="listener_config" path="on_error_propagate" allowedMethods="GET" />
        <set-payload value="#[1/0]" doc:name="Cause Error (Divide by Zero)" doc:id="2a4f136a-497a-4f72-aa9d-0bec782c6239" />
        <logger level="INFO" doc:name="Logger" doc:id="c492fc94-6338-4ed3-8ca8-472c2f4f4ad6" message="xxx: log after exception"/>
        <error-handler >
            <on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="72999e22-2e4d-4371-b747-dc8ce627ea39" >
                <logger level="INFO" doc:name="Logger" doc:id="88085ccb-999a-46eb-b3eb-768502bf2eeb" message="Error handled in on-error-propagate"/>
                <set-payload value="#['Custom error message: Something went wrong.']" doc:name="Set Payload" doc:id="85a9ce5b-abb9-477a-859a-18a3ddf45ba8" />
            </on-error-propagate>
        </error-handler>
    </flow>
</mule>

```
**Output (on_error_propagate_with_http_listener_source.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener listener_config = new (8083);

service /mule4 on listener_config {
    resource function get on_error_propagate(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        do {

            // set payload
            anydata payload0 = 1 / 0;
            ctx.payload = payload0;
            log:printInfo("xxx: log after exception");
        } on fail error err {
            // on-error-propagate
            log:printError("Message: " + err.message());
            log:printError("Trace: " + err.stackTrace().toString());

            log:printInfo("Error handled in on-error-propagate");

            // set payload
            string payload1 = "Custom error message: Something went wrong.";
            ctx.payload = payload1;
            ctx.attributes.response.statusCode = 500;
        }

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## Raise Error

- ### Basic Raise Error

**Input (basic_raise_error.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="HTTP_Listener_config">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="raise-error-example-flow">
        <http:listener config-ref="HTTP_Listener_config" path="/test"/>
        <choice>
            <when expression="#[message.attributes.queryParams.age &lt; 16]">
                <raise-error type="PRECONDITIONS:INCORRECT_AGE" description="Minimum age of 16 required to drive" />
            </when>
            <otherwise >
                <logger level="INFO" message="User age above 16 years. Allowed to drive"/>
            </otherwise>
        </choice>
    </flow>
</mule>

```
**Output (basic_raise_error.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public type PRECONDITIONS__INCORRECT_AGE distinct error;

public listener http:Listener HTTP_Listener_config = new (8081);

service / on HTTP_Listener_config {
    resource function default test(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        if ctx.attributes.request.getQueryParamValue("age") < 16 {
            fail error PRECONDITIONS__INCORRECT_AGE("Minimum age of 16 required to drive");
        } else {
            log:printInfo("User age above 16 years. Allowed to drive");
        }

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## Scatter Gather

- ### Basic Scatter-Gather

**Input (basic_scatter-gather.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
        http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
        http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">

    <flow name="scatterGatherFlow">
        <http:listener config-ref="HTTP_Listener_config"
                       path="/scatter"
                       doc:name="HTTP Listener"/>

        <scatter-gather doc:name="Scatter-Gather">
            <route>
                <set-payload value='Route 1 completed' doc:name="Set Payload 1"/>
            </route>
            <route>
                <set-payload value='Route 2 completed' doc:name="Set Payload 2"/>
            </route>
            <route>
                <set-payload value='Route 3 completed' doc:name="Set Payload 3"/>
            </route>
        </scatter-gather>
        <logger level="INFO" message="#[payload]" doc:name="Logger"/>
    </flow>

    <http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
        <http:listener-connection host="0.0.0.0" port="9090"/>
    </http:listener-config>
</mule>

```
**Output (basic_scatter-gather.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener HTTP_Listener_config = new (9090);

service / on HTTP_Listener_config {
    resource function default scatter(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // scatter-gather parallel execution
        fork {
            worker R0 returns anydata|error {
                // Route 0

                // set payload
                string payload0 = "Route 1 completed";
                ctx.payload = payload0;
                return ctx.payload;
            }
            worker R1 returns anydata|error {
                // Route 1

                // set payload
                string payload1 = "Route 2 completed";
                ctx.payload = payload1;
                return ctx.payload;
            }
            worker R2 returns anydata|error {
                // Route 2

                // set payload
                string payload2 = "Route 3 completed";
                ctx.payload = payload2;
                return ctx.payload;
            }
        }

        // wait for all workers to complete
        map<anydata|error> workerResults0 = wait {R0, R1, R2};
        map<anydata> scatterGatherResults0 = workerResults0.entries().'map(e => wrapRouteErrorIfExists(e[0], e[1])).'map(m => check m);
        ctx.payload = scatterGatherResults0;

        log:printInfo(ctx.payload.toString());

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

public function wrapRouteErrorIfExists(string key, anydata|error value) returns anydata|error {
    if value is error {
        return error(string `Error in Route ${key}: ${value.message()}`, value);
    }
    return value;
}

```

## Scheduler

- ### Basic Scheduler

**Input (basic_scheduler.xml):**
```xml
<mule xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:scheduler="http://www.mulesoft.org/schema/mule/scheduler"
      xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="
        http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
        http://www.mulesoft.org/schema/mule/scheduler http://www.mulesoft.org/schema/mule/scheduler/current/mule-scheduler.xsd">
    <flow name="schedulerFlow">
        <scheduler>
            <scheduling-strategy>
                <fixed-frequency frequency="5" timeUnit="SECONDS" startDelay="1"/>
            </scheduling-strategy>
        </scheduler>
        <logger level="INFO" message="Scheduler triggered]"/>
    </flow>
</mule>

```
**Output (basic_scheduler.bal):**
```ballerina
import ballerina/lang.runtime;
import ballerina/log;
import ballerina/task;

public type Context record {|
    anydata payload = ();
|};

class Job {
    *task:Job;

    public function execute() {
        log:printInfo("Scheduler triggered]");
    }
}

public function main() returns error? {
    runtime:sleep(1.0);
    task:JobId id = check task:scheduleJobRecurByFrequency(new Job(), 5.0);
}

```

## Set Payload

- ### Basic Set Payload

**Input (basic_set_payload.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/set_payload" allowedMethods="GET"/>
        <set-payload value="#['Hello world!']" doc:name="Set Payload" doc:id="9ffb8b0f-ef7d-4b03-b9f9-d862a8729b30" />
    </flow>
</mule>

```
**Output (basic_set_payload.bal):**
```ballerina
import ballerina/http;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get set_payload(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // set payload
        string payload0 = "Hello world!";
        ctx.payload = payload0;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Multiple Set Payloads

**Input (multiple_set_payloads.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/set_payload" allowedMethods="GET"/>
        <set-payload value="First payload" doc:name="Set Payload" doc:id="9ffb8b0f-ef7d-4b03-b9f9-d862a8729b30" />
        <set-payload value="#['Second payload']" doc:name="Set Payload" doc:id="3cc373d3-a9bc-4de1-aa9a-4c90b2f0b80f" />
        <set-payload value='#["Third payload"]' doc:name="Set Payload" doc:id="dbfb4b2a-7ff4-4ab0-8bb6-172304406fbf" />
    </flow>
</mule>

```
**Output (multiple_set_payloads.bal):**
```ballerina
import ballerina/http;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get set_payload(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // set payload
        string payload0 = "First payload";
        ctx.payload = payload0;

        // set payload
        string payload1 = "Second payload";
        ctx.payload = payload1;

        // set payload
        string payload2 = "Third payload";
        ctx.payload = payload2;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## Sub Flow

- ### Basic Sub Flow

**Input (basic_sub_flow.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/sub_flow" allowedMethods="GET"/>
        <logger level="INFO" doc:name="Logger" doc:id="af520ce8-f697-4442-8729-866a2a6ae7a4" message="xxx: logger invoked via http end point"/>
        <flow-ref doc:name="Flow Reference" doc:id="6022619f-49d4-4928-bfbf-ab4d31bc9b49" name="demoSubFlow"/>
        <logger level="INFO" doc:name="Logger" doc:id="192687ab-f765-4b7e-ad44-40ddcae9e62d" message="xxx: logger after flow reference invoked"/>
    </flow>
    <sub-flow name="demoSubFlow" doc:id="a341a351-05f2-4fa1-950c-3b630809bc2d" >
        <logger level="INFO" doc:name="Logger" doc:id="f2d03f15-d40b-40fc-91fa-af57257fa7e4" message="xxx: sub flow logger invoked"/>
        <set-payload value="This is a sub flow set-payload call" doc:name="Set Payload" doc:id="2d38087d-c540-4189-b0c3-53a5dafe59f6" />
    </sub-flow>
</mule>

```
**Output (basic_sub_flow.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get sub_flow(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo("xxx: logger invoked via http end point");
        demoSubFlow(ctx);
        log:printInfo("xxx: logger after flow reference invoked");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

public function demoSubFlow(Context ctx) {
    log:printInfo("xxx: sub flow logger invoked");

    // set payload
    string payload0 = "This is a sub flow set-payload call";
    ctx.payload = payload0;
}

```

## Transform Message

See [DataWeave Samples (Mule 4.x)](dataweave-mappings-v4.md) for more details on Dataweave conversions.

- ### Transform Message With Components

**Input (transform_message_with_components.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" host="0.0.0.0" port="8081" basePath="/foo" doc:name="HTTP Listener Configuration">
        <http:listener-connection host="0.0.0.0" port="8081"/>
    </http:listener-config>
    <flow name="mule6demoFlow">
        <http:listener config-ref="config" path="/" allowedMethods="GET" doc:name="HTTP"/>
        <ee:transform>
            <ee:message>
                <ee:set-payload resource="mule/v4/blocks/transform-message/dataweave-files/transform_message_with_components.dwl"/>
                <ee:variables>
                    <ee:set-variable variableName="myVariable" resource="mule/v4/blocks/transform-message/dataweave-files/transform_message_with_components.dwl"/>
                </ee:variables>
            </ee:message>
        </ee:transform>
    </flow>
</mule>

```
**Output (transform_message_with_components.bal):**
```ballerina
import ballerina/http;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /foo on config {
    resource function get .(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        json _dwOutput_ = _dwMethod0_(ctx);
        json myVariable = _dwMethod0_(ctx);
        ctx.payload = _dwOutput_;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

function _dwMethod0_(Context ctx) returns json {
    return "apple".toUpperAscii();
}

```

- ### Transform Message With Simple Value

**Input (transform_message_with_simple_value.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <http:listener-config name="config" host="0.0.0.0" port="8081" basePath="/foo" doc:name="HTTP Listener Configuration">
        <http:listener-connection host="0.0.0.0" port="8081"/>
    </http:listener-config>
    <flow name="mule6demoFlow">
        <http:listener config-ref="config" path="/" allowedMethods="GET" doc:name="HTTP"/>
        <ee:transform doc:name="Transform Message">
            <ee:message>
                <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{s1: "Hello World", s2: 'Hello World', n: 1.23, b: true, a:[1,2,3], o:{ name:  "Anne" }}]]></ee:set-payload>
            </ee:message>
        </ee:transform>
    </flow>
</mule>

```
**Output (transform_message_with_simple_value.bal):**
```ballerina
import ballerina/http;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /foo on config {
    resource function get .(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        json _dwOutput_ = check _dwMethod0_(ctx);
        ctx.payload = _dwOutput_;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

function _dwMethod0_(Context ctx) returns json|error {
    return {"s1": "Hello World", "s2": "Hello World", "n": 1.23, "b": true, "a": check [1, 2, 3].ensureType(json), "o": check {"name": "Anne"}.ensureType(json)};
}

```

- ### Transform Message With Unsupported Components

**Input (transform_message_with_unsupported_components.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
    <flow name="sampleFlow">
        <ee:transform>
            <ee:message>
                <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
[1, 2, 3, 4] map ,
]]></ee:set-payload>
            </ee:message>
        </ee:transform>
    </flow>
</mule>

```
**Output (transform_message_with_unsupported_components.bal):**
```ballerina
public type Context record {|
    anydata payload = ();
|};

function _dwMethod1_(xml payload) returns json {
    //TODO: UNSUPPORTED DATAWEAVE EXPRESSION 'map$+1' OF TYPE 'xml' FOUND. MANUAL CONVERSION REQUIRED.
}

function _dwMethod2_(json payload) returns json {
    //TODO: UNSUPPORTED DATAWEAVE EXPRESSION 'groupBy$.language' FOUND. MANUAL CONVERSION REQUIRED.
}

public function sampleFlow(Context ctx) {
    json _dwOutput_ = _dwMethod0_(ctx.payload.toJson());
    _dwOutput_ = _dwMethod1_(ctx.payload.toJson());
    _dwOutput_ = _dwMethod2_(ctx.payload.toJson());
    ctx.payload = _dwOutput_;
}

function _dwMethod0_(json payload) returns json {
    float conversionRate = 13.15;
    return [1, 2, 3, 4];
    // DATAWEAVE PARSING FAILED.
    // line 7:13 mismatched input 'map' expecting {<EOF>, NEWLINE}

}

```

## Try

- ### Basic Try Scope

**Input (basic_try_scope.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="HTTP_Listener_config">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="muleDemoFlow">
        <http:listener path="/checkAge" config-ref="HTTP_Listener_config" allowedMethods="POST"/>
        <logger level="INFO" message="Start of flow - Payload received: #[payload]"/>
        <try>
            <choice>
                <when expression="#[payload.age as Number &lt; 16]">
                    <raise-error type="PRECONDITIONS:INCORRECT_AGE" description="Age is below minimum requirement"/>
                </when>
                <otherwise>
                    <logger level="INFO" message="Age is acceptable: #[payload.age]"/>
                </otherwise>
            </choice>
            <error-handler>
                <on-error-continue logException="true">
                    <set-payload value='{ "status": "error", "message": "#[error.description]" }' mimeType="application/json"/>
                </on-error-continue>
            </error-handler>
        </try>

        <logger level="INFO" message="End of flow"/>
    </flow>
</mule>

```
**Output (basic_try_scope.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public type PRECONDITIONS__INCORRECT_AGE distinct error;

public listener http:Listener HTTP_Listener_config = new (8081);

service / on HTTP_Listener_config {
    resource function post checkAge(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        log:printInfo(string `Start of flow - Payload received: ${ctx.payload.toString()}`);
        do {
            if ctx.payload.age is Number < 16 {
                fail error PRECONDITIONS__INCORRECT_AGE("Age is below minimum requirement");
            } else {
                log:printInfo(string `Age is acceptable: ${ctx.payload.age.toString()}`);
            }
        } on fail error err {
            // on-error-continue
            log:printError("Message: " + err.message());
            log:printError("Trace: " + err.stackTrace().toString());

            // set payload
            anydata payload0 = string `{ "status": "error", "message": "${err.message()}" }`;
            ctx.payload = payload0;
        }
        log:printInfo("End of flow");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

## Variable

- ### Basic Set Variable

**Input (basic_set_variable.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:vm="http://www.mulesoft.org/schema/mule/vm" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/set_variable" allowedMethods="GET"/>
        <set-variable value="#['John']" doc:name="Set Variable" doc:id="c92878cc-4b5f-4965-858d-55c6ab90e62b" variableName="name" />
        <set-variable value="#[29]" doc:name="Set Variable" doc:id="b7e1dc14-9d13-4e89-b5bd-34d719f8d7ab" variableName="age"/>
        <set-variable value="USA" doc:name="Set Variable" doc:id="76718e06-caaf-4ed6-9d4f-f8c74889d6c7" variableName="from"/>
        <logger level="INFO" doc:name="Logger" doc:id="e2fe579d-338f-4c53-b3df-d085dd3990dd" message="Variables defined are: name - #[vars.name], age - #[vars['age']], from - #[vars['from']]"/>
    </flow>
</mule>

```
**Output (basic_set_variable.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Vars record {|
    string name?;
    int age?;
    string 'from?;
|};

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Vars vars = {};
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get set_variable(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        ctx.vars.name = "John";
        ctx.vars.age = 29;
        ctx.vars.'from = "USA";
        log:printInfo(string `Variables defined are: name - ${ctx.vars.name.toString()}, age - ${ctx.vars.age.toString()}, from - ${ctx.vars.'from.toString()}`);

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Simple Remove Variable

**Input (simple_remove_variable.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:vm="http://www.mulesoft.org/schema/mule/vm" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets"
      xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd">
    <http:listener-config name="config" doc:name="HTTP Listener config" doc:id="85b56e19-f77d-4d11-bfbe-b30beae6e98a" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>
    <flow name="demoFlow" doc:id="7e3855d0-bb40-460c-999b-b4705f53198c" >
        <http:listener doc:name="Listener" doc:id="2d80f8b6-ba81-46e0-91b7-516a8e4fdb67" config-ref="config" path="/remove_variable" allowedMethods="GET"/>
        <set-variable value="#['Hello']" doc:name="Set Variable" doc:id="c92878cc-4b5f-4965-858d-55c6ab90e62b" variableName="greeting" />
        <set-variable value="USA" doc:name="Set Variable" doc:id="76718e06-caaf-4ed6-9d4f-f8c74889d6c7" variableName="from"/>
        <logger level="INFO" doc:name="Logger" doc:id="3f618f6e-1097-4ede-afe8-983754c0525a" message="Variables before removing: greeting - #[vars.greeting], from - #[vars['from']]"/>
        <remove-variable doc:name="Remove Variable" doc:id="deed0bbe-6bf7-4d1e-a092-c3ff1aecab6c" variableName="greeting"/>
        <remove-variable doc:name="Remove Variable" doc:id="29e8b65e-286d-4315-b45e-34a3d36f0a76" variableName="#[vars.from]"/>
        <remove-variable doc:name="Remove Variable" doc:id="b1623562-be57-4239-b643-a8eea8de5d09" variableName="undefVar"/>
        <logger level="INFO" doc:name="Logger" doc:id="e2fe579d-338f-4c53-b3df-d085dd3990dd" message="Variables after removing: greeting - #[vars.greeting], from - #[vars['from']]"/>
    </flow>
</mule>

```
**Output (simple_remove_variable.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Vars record {|
    string greeting?;
    string 'from?;
|};

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Vars vars = {};
    Attributes attributes;
|};

public listener http:Listener config = new (8081);

service /mule4 on config {
    resource function get remove_variable(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        ctx.vars.greeting = "Hello";
        ctx.vars.'from = "USA";
        log:printInfo(string `Variables before removing: greeting - ${ctx.vars.greeting.toString()}, from - ${ctx.vars.'from.toString()}`);
        ctx.vars.greeting = ();
        ctx.vars.'from = ();
        log:printInfo(string `Variables after removing: greeting - ${ctx.vars.greeting.toString()}, from - ${ctx.vars.'from.toString()}`);

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

```

- ### Updating Same Variable

**Input (updating_same_variable.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="Listener">
        <http:listener-connection host="0.0.0.0" port="9091" />
    </http:listener-config>
    <configuration-properties doc:name="Configuration properties" doc:id="60c232be-ea26-4ab0-a71a-30f8e2c794ac" file="config.properties" />
    <flow name="raise-error-example-flow">
        <logger level="INFO" doc:name="Logger" doc:id="9e98ecb9-4e5e-4aac-bcb6-6121b72d8f37" message="flow starting logger invoked."/>
        <set-variable value="initial value" doc:name="Set Variable" doc:id="9ce291ac-8826-4fc0-858d-e9b38c809412" variableName="var1"/>
        <set-variable value="updated value" doc:name="Set Variable" doc:id="6511d009-f9e5-48ea-800a-f8271a78e4d1" variableName="var1"/>
        <logger level="INFO" doc:name="Logger" doc:id="2751abc7-ca74-4371-8d2f-2c361577fa83" message="flow ending logger invoked."/>
    </flow>
</mule>

```
**Output (updating_same_variable.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Vars record {|
    string var1?;
|};

public type Context record {|
    anydata payload = ();
    Vars vars = {};
|};

public listener http:Listener Listener = new (9091);

public function raise\-error\-example\-flow(Context ctx) {
    log:printInfo("flow starting logger invoked.");
    ctx.vars.var1 = "initial value";
    ctx.vars.var1 = "updated value";
    log:printInfo("flow ending logger invoked.");
}

```

## Vm Connector

- ### Simple Vm Connector

**Input (simple_vm_connector.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <vm:config name="vm_config" doc:name="VM Config" doc:id="86002305-9a20-41b5-9fa7-366f22f6b150" >
        <vm:queues >
            <vm:queue queueName="path-xxx" />
        </vm:queues>
    </vm:config>
    <flow name="vmPublishFlow" doc:id="fabf4ce6-4d19-4c08-a336-91ed5855cb89" >
        <set-payload value="#['Hello World!']" doc:name="Set Payload" doc:id="78cb0334-d2f9-4c20-929d-fc0b9d9487d6" />
        <vm:publish doc:name="Publish" doc:id="775463a5-2ebe-45e2-a404-6ca7dcff1a07" config-ref="vm_config" queueName="path-xxx"/>
    </flow>
    <flow name="vmListenerFlow" doc:id="818524a7-b63e-4503-bea9-0d9bfc3f01fe" >
        <vm:listener queueName="path-xxx" doc:name="Listener" doc:id="0aa2e312-4f64-4cf0-b329-55be7fa92e57" config-ref="vm_config"/>
        <logger level="INFO" doc:name="Logger" doc:id="28abd699-9ca3-4a74-8e80-ea47155a5403" message="Received a message: #[payload]"/>
    </flow>
</mule>

```
**Output (simple_vm_connector.bal):**
```ballerina
import ballerina/log;

public type Context record {|
    anydata payload = ();
|};

public function vmListenerFlow(Context ctx) {
    log:printInfo(string `Received a message: ${ctx.payload.toString()}`);
}

public function vmPublishFlow(Context ctx) {
    worker W returns error? {
        // VM Listener
        anydata receivedPayload = <- function;
        ctx.payload = receivedPayload;
        vmListenerFlow(ctx);
    }

    // set payload
    string payload0 = "Hello World!";
    ctx.payload = payload0;

    // VM Publish
    ctx.payload -> W;
}

```

- ### Vm Connector Inside Async Block

**Input (vm_connector_inside_async_block.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="listener_config" doc:name="HTTP Listener config" doc:id="73a0fa89-f2fe-48ca-a692-eb28f9809a9c" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8083" />
    </http:listener-config>
    <vm:config name="vm_config" doc:name="VM Config" doc:id="86002305-9a20-41b5-9fa7-366f22f6b150" >
        <vm:queues >
            <vm:queue queueName="path-xxx" />
        </vm:queues>
    </vm:config>
    <flow name="vmPublishFlow" doc:id="fabf4ce6-4d19-4c08-a336-91ed5855cb89" >
        <http:listener doc:name="Listener" doc:id="3c0de3f4-a0bb-45f1-8738-c895f39dfc28" config-ref="listener_config" path="vm" allowedMethods="GET"/>
        <set-payload value="#['Hello World!']" doc:name="Set Payload" doc:id="78cb0334-d2f9-4c20-929d-fc0b9d9487d6" />
        <async doc:name="Async" doc:id="71864892-7961-40ed-a7a2-60c3b7231c53" >
            <vm:publish doc:name="Publish" doc:id="775463a5-2ebe-45e2-a404-6ca7dcff1a07" config-ref="vm_config" queueName="path-xxx" />
        </async>
        <logger level="INFO" doc:name="Logger" doc:id="34ed4cd4-2e3d-45c9-b44c-dbe1494e5cb5" message="xxx: logger after async block"/>
    </flow>
    <flow name="vmListenerFlow" doc:id="818524a7-b63e-4503-bea9-0d9bfc3f01fe" >
        <vm:listener queueName="path-xxx" doc:name="Listener" doc:id="0aa2e312-4f64-4cf0-b329-55be7fa92e57" config-ref="vm_config"/>
        <logger level="INFO" doc:name="Logger" doc:id="28abd699-9ca3-4a74-8e80-ea47155a5403" message="Received a message: #[payload]"/>
    </flow>
</mule>

```
**Output (vm_connector_inside_async_block.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener listener_config = new (8083);

service /mule4 on listener_config {
    resource function get vm(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};

        // set payload
        string payload0 = "Hello World!";
        ctx.payload = payload0;

        // async operation
        _ = start async0(ctx);
        log:printInfo("xxx: logger after async block");

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

public function vmReceive0(Context ctx) {
    log:printInfo(string `Received a message: ${ctx.payload.toString()}`);
}

public function async0(Context ctx) {
    worker W returns error? {
        // VM Listener
        anydata receivedPayload = <- function;
        ctx.payload = receivedPayload;
        vmReceive0(ctx);
    }

    // VM Publish
    ctx.payload -> W;
}

```

- ### Vm Connector Wth Http Source

**Input (vm_connector_wth_http_source.xml):**
```xml
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:db="http://www.mulesoft.org/schema/mule/db" xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
      xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:sockets="http://www.mulesoft.org/schema/mule/sockets" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/sockets http://www.mulesoft.org/schema/mule/sockets/current/mule-sockets.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd">
    <http:listener-config name="listener_config" doc:name="HTTP Listener config" doc:id="73a0fa89-f2fe-48ca-a692-eb28f9809a9c" basePath="mule4">
        <http:listener-connection host="0.0.0.0" port="8083" />
    </http:listener-config>
    <vm:config name="vm_config" doc:name="VM Config" doc:id="86002305-9a20-41b5-9fa7-366f22f6b150" >
        <vm:queues >
            <vm:queue queueName="path-xxx" />
        </vm:queues>
    </vm:config>
    <flow name="vmPublishFlow" doc:id="fabf4ce6-4d19-4c08-a336-91ed5855cb89" >
        <http:listener doc:name="Listener" doc:id="3c0de3f4-a0bb-45f1-8738-c895f39dfc28" config-ref="listener_config" path="vm" allowedMethods="GET"/>
        <set-payload value="#['Hello World!']" doc:name="Set Payload" doc:id="78cb0334-d2f9-4c20-929d-fc0b9d9487d6" />
        <vm:publish doc:name="Publish" doc:id="775463a5-2ebe-45e2-a404-6ca7dcff1a07" config-ref="vm_config" queueName="path-xxx"/>
    </flow>
    <flow name="vmListenerFlow" doc:id="818524a7-b63e-4503-bea9-0d9bfc3f01fe" >
        <vm:listener queueName="path-xxx" doc:name="Listener" doc:id="0aa2e312-4f64-4cf0-b329-55be7fa92e57" config-ref="vm_config"/>
        <logger level="INFO" doc:name="Logger" doc:id="28abd699-9ca3-4a74-8e80-ea47155a5403" message="Received a message: #[payload]"/>
    </flow>
</mule>

```
**Output (vm_connector_wth_http_source.bal):**
```ballerina
import ballerina/http;
import ballerina/log;

public type Attributes record {|
    http:Request request;
    http:Response response;
    map<string> uriParams = {};
|};

public type Context record {|
    anydata payload = ();
    Attributes attributes;
|};

public listener http:Listener listener_config = new (8083);

service /mule4 on listener_config {
    resource function get vm(http:Request request) returns http:Response|error {
        Context ctx = {attributes: {request, response: new}};
        worker W returns error? {
            // VM Listener
            anydata receivedPayload = <- function;
            ctx.payload = receivedPayload;
            vmReceive0(ctx);
        }

        // set payload
        string payload0 = "Hello World!";
        ctx.payload = payload0;

        // VM Publish
        ctx.payload -> W;

        ctx.attributes.response.setPayload(ctx.payload);
        return ctx.attributes.response;
    }
}

public function vmReceive0(Context ctx) {
    log:printInfo(string `Received a message: ${ctx.payload.toString()}`);
}

```

